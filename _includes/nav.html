<header class="site-header">
    <!-- Apply saved/OS theme ASAP -->
    <script>
      if (
        localStorage.theme === 'dark' ||
        (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)
      ) {
        document.documentElement.classList.add('theme-dark');
      }
    </script>
  
    <nav class="site-nav flex align-center font-ui">
      <!-- Left: site title (not bold) -->
      <span class="flex-grow">
        <a class="internal-link plain site-brand" href="{{ site.baseurl }}/">{{ site.title }}</a>
      </span>
  
      <!-- Right: links -->
      <span class="flex-shrink ssr site-links">
        <a href="/about" class="muted plain">about</a>
        <a href="/now" class="muted plain ssl mh">now</a>
      </span>
  
      <!-- Theme toggle -->
      <button id="theme-toggle" title="toggle dark mode" aria-label="toggle dark mode" type="button" role="switch" aria-checked="false">
        <div class="theme-toggle-slide"></div>
        <div class="theme-toggle-switch"></div>
      </button>
    </nav>
  </header>
  
  <!-- Toggle logic -->
  <script>
    (function () {
      const root = document.documentElement;
      const btn = document.getElementById('theme-toggle');
  
      function setMode(mode) {
        root.classList.toggle('theme-dark', mode === 'dark');
        btn.setAttribute('aria-checked', String(mode === 'dark'));
        localStorage.theme = mode;
      }
  
      // Initial state (respect saved or OS)
      const initial =
        localStorage.theme ? localStorage.theme :
        (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
      setMode(initial);
  
      btn.addEventListener('click', () => {
        setMode(root.classList.contains('theme-dark') ? 'light' : 'dark');
      });
    })();
  </script>